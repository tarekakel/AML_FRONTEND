<div class="p-4 bg-white rounded-2xl shadow-md">

    <div class="mb-4 flex justify-between items-center">
        <!-- <h2 class="text-xl font-semibold text-gray-800">Users</h2> -->
        <!-- Header + Search -->
        <div class="mb-4 flex flex-col sm:flex-row justify-between items-center gap-4">
            <h2 class="text-xl font-semibold text-gray-800">User List</h2>


            <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
                placeholder="Search by email or username..."
                class="w-full sm:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <button (click)="openModal(null)"
            class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition">
            + Add User
        </button>


    </div>

    <div class="overflow-x-auto">
        <table class="min-w-full text-sm text-left text-gray-700">
            <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
                <tr>
                    <th class="px-6 py-3">#</th>
                    <th class="px-6 py-3">Email</th>
                    <!-- <th class="px-6 py-3">Username</th> -->
                    <th class="px-6 py-3">Avatar</th>
                    <th class="px-6 py-3 text-center">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                <!-- Example row, replace with *ngFor -->
                <tr *ngFor="let user of res?.data; let i = index" class="hover:bg-gray-50">
                    <td class="px-6 py-4">{{ i + 1 }}</td>
                    <td class="px-6 py-4">{{ user.email }}</td>
                    <!-- <td class="px-6 py-4">{{ user.username }}</td> -->
                    <td class="px-6 py-4">
                        <img [src]="user.avatar_url ?? 'assets/images/default-avatar.svg'" alt="Avatar"
                            class="h-10 w-10 rounded-full object-cover" />
                    </td>

                    <td class="px-6 py-4 text-center space-x-2">
                        <button class="px-3 py-1 bg-green-500 text-white rounded-md text-xs hover:bg-green-600"
                            (click)="openModal(user)">Edit</button>
                        <button
                            class="px-3 py-1 bg-red-500 text-white rounded-md text-xs hover:bg-red-600">Delete</button>
                        <button class="px-3 py-1 bg-yellow-500 text-white rounded-md text-xs hover:bg-yellow-600"
                            (click)="resetPassword(user)">
                            Reset Password
                        </button>
                    </td>



                </tr>
            </tbody>
        </table>

        <!-- Pagination -->
        <div class="mt-6 flex justify-between items-center text-sm">
            <div>
                Page {{ page }} of {{ totalPages }} â€” Showing {{ res?.data.length }} of {{ totalCount }} results
            </div>

            <div class="space-x-2">
                <button [disabled]="page === 1" (click)="goToPage(page - 1)"
                    class="px-3 py-1 rounded-lg border bg-gray-100 hover:bg-gray-200 disabled:opacity-50">
                    Prev
                </button>
                <button [disabled]="page === totalPages" (click)="goToPage(page + 1)"
                    class="px-3 py-1 rounded-lg border bg-gray-100 hover:bg-gray-200 disabled:opacity-50">
                    Next
                </button>
            </div>
        </div>
    </div>
    <app-loader *ngIf="isLoading"></app-loader>

    <app-user-modal [user]="selectedUser" [show]="showModal" (save)="saveUser($event)"
        (close)="showModal = false"></app-user-modal>

    <app-confim-dialoge [show]="showConfirmModal" [isLoading]="isResetLoading" [title]="'Reset Password'"
        [message]="'Reset password for ' + selectedUser?.email + '?'" (confirm)="handleConfirm()"
        (cancel)="handleCancel()"></app-confim-dialoge>